<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="hostinfo">
	<select id="checkNo" parameterType="int" resultType="int">
		<![CDATA[
			select  hostNo
			from    host
			where	hostNo = #{hostNo}
		]]>
	</select>
	
	<select id="getHost" parameterType="int" resultType="HostVo">
		<![CDATA[
			select ho.hostNo,
			       ho.userNo,
			       us.name,
			       us.hp,
			       us.path,
			       ho.zipcode,
			       ho.adress1,
			       ho.adress2,
			       ho.adress3,
			       ho.x,
			       ho.y,
			       ho.intro,
			       ho.asking,
			       ho.hostcost,
			       co.reviewcount,
			       ho.hostview
			from   users us, host ho, (select count(review) reviewcount
                              		   from   booking) co
			where  hostNo = #{hostNo}
            and    us.usersNo = ho.userNo
		]]>
	</select>
	
	<select id="getKeywordList" parameterType="int" resultType="KeywordVo">
		<![CDATA[
			select   hk.hostNo,
			         ke.keywordName
			from     hostkeyword hk, keyword ke
			where    hk.keywordNo = ke.keywordNo
			and      hk.hostNo = #{hostNo}
			order by ke.keywordno asc
		]]>
	</select>
	
	<select id="getReview" parameterType="int" resultType="ReviewVo">
		<![CDATA[
			select bo.bookingNo,
			       us.usersno,
			       us.name,
			       us.path,
			       bo.review,
			       bo.reviewDate
			from   booking bo, users us
			where  bo.usersNo = us.usersNo
			and    bo.hostNo = #{hostNo}
		]]>
	</select>
	
	<select id="getSum" parameterType="int" resultType="double">
		<![CDATA[
			select SUM(clean) + SUM(food) + SUM(play) + SUM(walk) + SUM(communication)
			from   booking
			where  hostNo = #{hostNo}
		]]>
	</select>
	
	<select id="getReviewCount" parameterType="int" resultType="int">
		<![CDATA[
			select count(review)
			from   booking
			where  hostNo = #{hostNo}
		]]>
	</select>
	
	<select id="getClean" parameterType="int" resultType="double">
		<![CDATA[
			select avg(clean)
			from   booking
			where  hostNo = #{hostNo}
		]]>
	</select>
	
	<select id="getFood" parameterType="int" resultType="double">
		<![CDATA[
			select avg(food)
			from   booking
			where  hostNo = #{hostNo}
		]]>
	</select>
	
	<select id="getPlay" parameterType="int" resultType="double">
		<![CDATA[
			select avg(play)
			from   booking
			where  hostNo = #{hostNo}
		]]>
	</select>
	
	<select id="getWalk" parameterType="int" resultType="double">
		<![CDATA[
			select avg(walk)
			from   booking
			where  hostNo = #{hostNo}
		]]>
	</select>
	
	<select id="getCommunication" parameterType="int" resultType="double">
		<![CDATA[
			select avg(communication)
			from   booking
			where  hostNo = #{hostNo}
		]]>
	</select>
	
	<select id="getHostPhotoList" parameterType="int" resultType="PhotoVo">
		<![CDATA[
			select hostNo,
			       hostprofilepath as photoPath
			from   hostprofile
			where  hostNo = #{hostNo}
		]]>
	</select>
	
	<select id="getPayment" parameterType="int" resultType="BookingVo">
		<![CDATA[
			select bookingNo,
				   hostNo,
			       to_char(checkin, 'YYYY-MM-DD') checkin,
			       to_char(checkout, 'YYYY-MM-DD') checkout,
			       ea,
			       bookingDate,
			       days,
			       note
			from   booking
			where  bookingNo = #{bookingNo}
		]]>
	</select>
	
	<insert id="bookinginsert" parameterType="BookingVo">
		<![CDATA[
			insert into booking
			values(seq_booking_no.nextval, #{hostNo}, #{usersNo}, #{checkin}, #{checkout}, #{ea}, #{bookingDate}, #{days}, #{note}, '승인대기', null, null, null, null, null, null, null)
		]]>
	</insert>
	
	<update id="setStatus" parameterType="BookingVo">
		<![CDATA[
			update booking
			set    status = #{status}
			where  bookingNo = #{bookingNo}
		]]>
	</update>
</mapper>