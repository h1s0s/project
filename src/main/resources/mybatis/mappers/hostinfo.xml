<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="hostinfo">
	<select id="checkNo" parameterType="int" resultType="int">
		<![CDATA[
			select  hostNo
			from    host
			where	hostNo = #{hostNo}
		]]>
	</select>
	
	<select id="getHost" parameterType="int" resultType="HostVo">
		<![CDATA[
			select ho.hostNo,
			       ho.usersNo,
			       us.name,
			       us.hp,
			       us.path,
			       ho.zipcode,
			       ho.adress1,
			       ho.adress2,
			       ho.adress3,
			       ho.x,
			       ho.y,
			       ho.intro,
			       ho.asking,
			       ho.hostcost,
			       co.reviewcount,
			       ho.hostview
			from   users us, host ho, (select count(review) reviewcount
                              		   from   booking
                              		   where  hostNo = #{hostNo}) co
			where  hostNo = #{hostNo}
            and    us.usersNo = ho.usersNo
		]]>
	</select>
	
	<select id="getKeywordList" parameterType="int" resultType="KeywordVo">
		<![CDATA[
			select   hk.hostNo,
			         ke.keywordName
			from     hostkeyword hk, keyword ke
			where    hk.keywordNo = ke.keywordNo
			and      hk.hostNo = #{hostNo}
			order by ke.keywordno asc
		]]>
	</select>
	
	<select id="getReview" parameterType="int" resultType="ReviewVo">
		<![CDATA[
			select bo.bookingNo,
			       us.usersno,
			       us.name,
			       us.path,
			       bo.review,
			       to_char(bo.reviewDate, 'YYYY-MM-DD') reviewDate
			from   booking bo, users us
			where  bo.usersNo = us.usersNo
			and    bo.hostNo = #{hostNo}
		]]>
	</select>
	
	<select id="getSum" parameterType="int" resultType="double">
		<![CDATA[
			select NVL(SUM(clean), 0) + NVL(SUM(food), 0) + NVL(SUM(play), 0) + NVL(SUM(walk), 0) + NVL(SUM(communication), 0)
			from   booking
			where  hostNo = #{hostNo}
		]]>
	</select>
	
	<select id="getReviewCount" parameterType="int" resultType="int">
		<![CDATA[
			select count(review)
			from   booking
			where  hostNo = #{hostNo}
		]]>
	</select>
	
	<select id="getClean" parameterType="int" resultType="double">
		<![CDATA[
			select NVL(avg(clean), 0)
			from   booking
			where  hostNo = #{hostNo}
		]]>
	</select>
	
	<select id="getFood" parameterType="int" resultType="double">
		<![CDATA[
			select NVL(avg(food), 0)
			from   booking
			where  hostNo = #{hostNo}
		]]>
	</select>
	
	<select id="getPlay" parameterType="int" resultType="double">
		<![CDATA[
			select NVL(avg(play), 0)
			from   booking
			where  hostNo = #{hostNo}
		]]>
	</select>
	
	<select id="getWalk" parameterType="int" resultType="double">
		<![CDATA[
			select NVL(avg(walk), 0)
			from   booking
			where  hostNo = #{hostNo}
		]]>
	</select>
	
	<select id="getCommunication" parameterType="int" resultType="double">
		<![CDATA[
			select NVL(avg(communication), 0)
			from   booking
			where  hostNo = #{hostNo}
		]]>
	</select>
	
	<select id="getHostPhotoList" parameterType="int" resultType="PhotoVo">
		<![CDATA[
			select hostNo,
			       hostprofilepath as photoPath
			from   hostprofile
			where  hostNo = #{hostNo}
		]]>
	</select>
	
	<select id="getCalendur" parameterType="int" resultType="BookingVo">
		<![CDATA[
			select  bo.checkin,
			        bo.checkout,
			        us.name guestName
			from    booking bo, users us
			where   hostNo = #{hostNo}
			and     bo.usersNo = us.usersNo
		]]>
	</select>
	
	<select id="getPhoto" parameterType="PhotoVo" resultType="PhotoVo">
		<![CDATA[
			select ph.photoPath,
			       bo.hostNo
			from   photo ph, booking bo
			where  ph.bookingNo = bo.bookingNo
			and    bo.hostNo = #{hostNo}
			and    ph.category = #{category}
		]]>
	</select>
	
	<select id="getKeywordList2" resultType="keywordVo">
		<![CDATA[
			select   keywordNo,
			         keywordName
			from     keyword
			order by keywordNo asc
		]]>
	</select>
	
	<select id="getPayment" parameterType="int" resultType="BookingVo">
		<![CDATA[
			select bookingNo,
				   hostNo,
			       to_char(checkin, 'YYYY-MM-DD') checkin,
			       to_char(checkout, 'YYYY-MM-DD') checkout,
			       ea,
			       bookingDate,
			       days,
			       note
			from   booking
			where  bookingNo = #{bookingNo}
		]]>
	</select>
	
	<insert id="hostinsert" parameterType="hostVo">
		<selectKey keyProperty="hostNo" resultType="int" order="BEFORE">
			select seq_host_no.nextval from dual
		</selectKey>
		<![CDATA[
			insert into host
			values(#{hostNo}, #{usersNo}, #{zipcode}, #{adress1}, #{adress2}, #{adress3}, 0, 0, #{intro}, #{asking}, #{hostcost}, 1)
		]]>
	</insert>
	
	<insert id="bookinginsert" parameterType="BookingVo">
		<![CDATA[
			insert into booking
			values(seq_booking_no.nextval, #{hostNo}, #{usersNo}, #{checkin}, #{checkout}, #{ea}, #{bookingDate}, #{days}, #{note}, '승인대기', null, null, null, null, null, null, null)
		]]>
	</insert>
	
	<insert id="setHostPhoto" parameterType="PhotoVo">
		<![CDATA[
			insert into hostprofile
			values(seq_hostprofile_no.nextval,#{hostNo}, sysdate, #{photoPath})
		]]>
	</insert>
	
	<insert id="setKeyword" parameterType="KeywordVo">
		<![CDATA[
			insert into hostkeyword
			values(seq_hostkeyword_no.nextval, #{hostNo}, #{keywordNo})
		]]>
	</insert>
	
	<update id="setStatus" parameterType="BookingVo">
		<![CDATA[
			update booking
			set    status = #{status}
			where  bookingNo = #{bookingNo}
		]]>
	</update>
	
	<update id="typeUpdate" parameterType="int">
		<![CDATA[
			update users
			set    userstype = 2
			where  usersNo = #{usersNo}
		]]>
	</update>
</mapper>