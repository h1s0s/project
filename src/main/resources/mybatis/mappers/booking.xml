<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="booking">

	<select id="bookingList" parameterType="int" resultType="com.javaex.vo.BookingVo">
		<![CDATA[
			select bookingNo,
			       hostNo,
			       usersno,
			       checkin,
			       checkout,
			       ea,
			       booking_date,
			       days,
			       note,
			       status,
			       review,
			       review_date,
			       clean,
			       food,
			       play,
			       work,
			       communication
			from booking
			where usersno = #{usersNo}
		]]>
	</select>
	
	<!-- 결제대기리스트(게스트) -->
	<select id="bookingHostList" parameterType="int" resultType="com.javaex.vo.BookingVo">
		<![CDATA[
			select bookingNo,
			       b.hostNo,
			       b.usersno,
			       to_char(checkin, 'yyyy-mm-dd') checkin,
       			   to_char(checkout, 'yyyy-mm-dd') checkout,
			       ea,
			       booking_date bookingDate,
			       days,
			       note,
			       status,
			       review,
			       review_date reviewDate,
			       clean,
			       food,
			       play,
			       work,
			       communication,
			       u.name hostName,
			       u.hp hostHp
			from booking b, host h, users u
			where b.hostno = h.hostno
			and h.userno = u.usersno
			and b.usersno = #{usersNo}
			and b.status in('승인대기', '결제대기')
		]]>
	</select>
	
	<!-- 결제대기리스트(호스트) -->
	<select id="bookingGuestList" parameterType="int" resultType="com.javaex.vo.BookingVo">
		<![CDATA[
			select b.bookingNo,
			       b.hostNo,
			       b.usersNo,
			       to_char(checkin, 'yyyy-mm-dd') checkin,
			       to_char(checkout, 'yyyy-mm-dd') checkout,
			       b.ea,
			       b.booking_date bookingDate,
			       b.days,
			       b.note,
			       b.status,
			       b.review,
			       b.review_date reviewDate,
			       b.clean,
			       b.food,
			       b.play,
			       b.work,
			       b.communication,
			       u.name guestName,
			       u.hp guestHp
			from booking b, users u
			where b.usersNo = u.usersNo
			and hostNo = #{hostNo}
			and b.status in('승인대기', '결제대기')
		]]>
	</select>
	
	<!-- 결제대기리스트(호스트) -->
	<select id="bookingDateList" parameterType="com.javaex.vo.BookingVo" resultType="com.javaex.vo.BookingVo">
		<![CDATA[
			select b.bookingNo,
			       b.hostNo,
			       b.usersNo,
			       to_char(checkin, 'yyyy-mm-dd') checkin,
			       to_char(checkout, 'yyyy-mm-dd') checkout,
			       b.ea,
			       b.booking_date bookingDate,
			       b.days,
			       b.note,
			       b.status,
			       b.review,
			       b.review_date reviewDate,
			       b.clean,
			       b.food,
			       b.play,
			       b.work,
			       b.communication,
			       u.name guestName,
			       u.hp guestHp
			from booking b, users u
			where b.usersNo = u.usersNo
			and hostNo = #{hostNo}
			and	checkin = #{checkin}
			and b.status in('승인대기', '결제대기')
		]]>
	</select>
	
	<!-- 예약상세(게스트) -->
	<select id="bookingDetailHost" parameterType="int" resultType="com.javaex.vo.BookingVo">
		<![CDATA[
			select bookingNo,
			       b.hostNo,
			       b.usersno,
			       to_char(checkin, 'yyyy-mm-dd') checkin,
       			   to_char(checkout, 'yyyy-mm-dd') checkout,
			       ea,
			       booking_date bookingDate,
			       days,
			       note,
			       status,
			       review,
			       review_date reviewDate,
			       clean,
			       food,
			       play,
			       work,
			       communication,
			       u.name hostName,
			       u.hp hostHp,
			       h.adress1 adress1,
			       h.adress2 adress2,
			       h.adress3 adress3
			from booking b, host h, users u
			where b.hostno = h.hostno
			and h.userno = u.usersno
			and bookingNo = #{bookingNo}
		]]>
	</select>
	
	<!-- 예약상세(호스트) -->
	<select id="bookingDetailGuest" parameterType="int" resultType="com.javaex.vo.BookingVo">
		<![CDATA[
			select bookingNo,
			       b.hostNo,
			       b.usersno,
			       to_char(checkin, 'yyyy-mm-dd') checkin,
       			   to_char(checkout, 'yyyy-mm-dd') checkout,
			       ea,
			       booking_date bookingDate,
			       days,
			       note,
			       status,
			       review,
			       review_date reviewDate,
			       clean,
			       food,
			       play,
			       work,
			       communication,
			       u.name guestName,
       			   u.hp guestHp,
			       h.adress1 adress1,
			       h.adress2 adress2,
			       h.adress3 adress3
			from booking b, host h, users u
			where b.hostno = h.hostno
			and b.usersno = u.usersno
			and bookingNo = #{bookingNo}
		]]>
	</select>
	
	<!-- 예약상세갤러리 -->
	<select id="photoList" parameterType="com.javaex.vo.PhotoVo" resultType="com.javaex.vo.PhotoVo">
		<![CDATA[
			select photono,
			       bookingno,
			       category,
			       to_char(photodate, 'yyyy-mm-dd day') photodate,
			       photopath,
			       phototitle,
			       saveName
			from photo
			where bookingno = #{bookingNo}
			and day = #{day}
		]]>
	</select>
	
	<!-- 파일업로드 -->
	<insert id="photoInsert" parameterType="com.javaex.vo.PhotoVo">
		<![CDATA[
			insert into photo
			values(SEQ_PHOTO_NO.nextval, #{bookingNo}, TO_DATE(#{photoDate}, 'yyyymmdd'), #{category}, #{photoTitle}, #{photoPath}, #{saveName}, #{day})
		]]>
	</insert>
	
	<!-- 사진상세 -->
	<select id="photoView" parameterType="int" resultType="com.javaex.vo.PhotoVo">
		<![CDATA[
			select photono,
			       bookingno,
			       phototitle,
			       saveName
			from photo
			where photono = #{photoNo}
		]]>
	</select>
	
	<!-- 예약완료리스트(호스트) -->
	<select id="bookingEndGuestList" parameterType="int" resultType="com.javaex.vo.BookingVo">
		<![CDATA[
			select b.bookingNo,
			       b.hostNo,
			       b.usersNo,
			       to_char(checkin, 'yyyy-mm-dd') checkin,
			       to_char(checkout, 'yyyy-mm-dd') checkout,
			       b.ea,
			       b.booking_date bookingDate,
			       b.days,
			       b.note,
			       b.status,
			       b.review,
			       b.review_date reviewDate,
			       b.clean,
			       b.food,
			       b.play,
			       b.work,
			       b.communication,
			       u.name guestName,
			       u.hp guestHp
			from booking b, users u
			where b.usersNo = u.usersNo
			and hostNo = #{hostNo}
			and b.status in('예약완료', '펫시팅중', '시팅완료')
		]]>
	</select>
	
	<!-- 가능날짜추가 -->
	<insert id="ableInsert" parameterType="com.javaex.vo.AbleVo">
		<![CDATA[
			insert into able
			values(seq_able_no.nextval, #{hostNo}, TO_DATE(#{ableDate}, 'yyyymmdd'))
		]]>
	</insert>
	
	<!-- 가능날짜 리스트 -->
	<select id="ableSelect" parameterType="int" resultType="com.javaex.vo.AbleVo">
		<![CDATA[
			select ableNo,
			       hostNo,
			       to_char(ableDate, 'yyyymmdd') ableDate
			from able
			where hostNo = #{hostNo}
		]]>
	</select>
	
</mapper>