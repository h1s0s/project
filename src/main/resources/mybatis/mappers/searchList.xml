<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="searchList">
		
			<select id="selectSearchList" parameterType="SearchListVo" resultType="SearchListVo">
					<![CDATA[
					  select    h.hostNo hostNo,
						        u.name hostName,
						        u.path path,
						        h.hostView hostView,
						        h.adress1 adress1,
						        h.adress3 adress3,
						        c.rp reviewPoint,
						        h.hostCost hostCost,
						        trunc(c.pp,1) puppyPoint,
						        trunc(c.clean,1) clean,
						        trunc(c.walk,1) walk,
						        trunc(c.play,1) play,
						        trunc(c.food,1) food,
						        trunc(c.communication,1) communication,
						        c.rp review
						from    users u, host h, (select     h.hostNo, 
						                                     count(review) rp,
						                                     ((avg(clean) + avg(walk) + avg(play) + avg(food) + avg(communication))/5) pp,
						                                     avg(clean) clean,
						                                     avg(walk) walk,
						                                     avg(play) play,
						                                     avg(food) food,
						                                     avg(communication) communication        
						                          from       booking b, users u, host h
						                          where      b.hostNo(+) = h.hostNo
						                          and        h.usersNo = u.usersNo
						                          group by   h.hostNo ) c, (select    h.hostno
						                                                     from      able a, host h, booking b
						                                                     where     a.abledate between #{checkin} and #{checkout}
						                                                     and not   checkin between #{checkin}  and #{checkout}
						                                                     and not   checkout between #{checkin}  and #{checkout}
						                                                     and       a.hostNo = h.hostNo
						                                                     and       h.hostNo = b.hostNo
						                                                     group by  h.hostno) a
						where u.usersNo = h.usersNo
						and   c.hostNo = h.hostNo
						and   a.hostNo = h.hostNo
						and hostView = 1]]> 
					    <include refid="search"></include>
					    <choose>
							  <when test="orderType = null">
								  order by h.hostNo desc
							  </when>
							  <when test="orderType = 1">
								  order by c.clean desc
							  </when>
							  <when test="orderType = 2">
								  order by c.walk desc
							  </when>
							  <when test="orderType = 3">
								  order by c.play desc
							  </when>
							  <when test="orderType = 4">
								  order by c.food desc
							  </when>
							  <when test="orderType = 5">
								  order by c.communication desc
							  </when>
					  </choose> 
			</select>	
		
			<select id="selectSearchListD" parameterType="SearchListVo" resultType="SearchListVo">
				<![CDATA[
				  select    h.hostNo hostNo,
					        u.name hostName,
					        u.path path,
					        h.hostView hostView,
					        h.adress1 adress1,
					        h.adress3 adress3,
					        c.rp reviewPoint,
					        h.hostCost hostCost,
					        trunc(c.pp,1) puppyPoint,
					        trunc(c.clean,1) clean,
					        trunc(c.walk,1) walk,
					        trunc(c.play,1) play,
					        trunc(c.food,1) food,
					        trunc(c.communication,1) communication,
					        c.rp review
					from    users u, host h, (select     h.hostNo, 
					                                     count(review) rp,
					                                     ((avg(clean) + avg(walk) + avg(play) + avg(food) + avg(communication))/5) pp,
					                                     avg(clean) clean,
					                                     avg(walk) walk,
					                                     avg(play) play,
					                                     avg(food) food,
					                                     avg(communication) communication        
					                          from       booking b, users u, host h
					                          where      b.hostNo(+) = h.hostNo
					                          and        h.usersNo = u.usersNo
					                          group by   h.hostNo ) c
					where u.usersNo = h.usersNo
					and   c.hostNo = h.hostNo
					and hostView = 1]]> 
				  <include refid="search"></include>
	
				  <choose>
						<when test="orderType = null">
							order by h.hostNo desc
						</when>
						<when test="orderType = 1">
							order by c.clean desc
						</when>
						<when test="orderType = 2">
							order by c.walk desc
						</when>
						<when test="orderType = 3">
							order by c.play desc
						</when>
						<when test="orderType = 4">
							order by c.food desc
						</when>
						<when test="orderType = 5">
							order by c.communication desc
						</when>
				  </choose> 
				  
		</select>
	  	
		<sql id="search">
				<if test="searchKeyword != null and searchKeyword != ''.toString()">
						and
					<if test="searchKeyword.toString()">
						adress1 like '%' || #{searchKeyword} || '%'
					</if>
				</if>
		</sql>

</mapper>