<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="searchList">
		
		<select id="selectSearchList" parameterType="SearchListVo" resultType="SearchListVo">
				<![CDATA[
				  select  h.hostNo hostNo,
				          u.name name,
				          u.path path,
				          h.adress1 adress1,
				          h.adress3 adress3,
				          c.rp reviewPoint,
				          h.hostCost hostCost,
				          trunc( c.pp,1) puppyPoint,
				          trunc(c.clean,1) clean,
				          trunc(c.walk,1) walk,
				          trunc(c.play,1) play,
				          trunc(c.food,1) food,
				          trunc(c.communication,1) communication,
				          c.rp review
				  from    users u, host h, (select   hostNo, 
				                                     count(review) rp,
				                                     ((avg(clean) + avg(walk) + avg(play) + avg(food) + avg(communication))/5) pp,
				                                     avg(clean) clean,
				                                     avg(walk) walk,
				                                     avg(play) play,
				                                     avg(food) food,
				                                     avg(communication) communication        
				                              from   booking b, users u
				                              group by hostNo ) c
				  where u.usersNo = h.usersNo
				  and   c.hostNo = h.hostNo
				  order by h.hostNo desc
				  ]]>	
				  <include refid="search"></include>
				  
		</select>
	  	
		<sql id="search">
				<if test="searchKeyword != null and searchKeyword != ''.toString()">
						and
					<if test="searchKeyword.toString()">
						adress1 like '%' || #{searchKeyword} || '%'
					</if>
				</if>
		</sql>

</mapper>